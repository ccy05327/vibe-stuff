<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>互動式報告：解構全球城市「黏著度」</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
      src="https://cdn.plot.ly/plotly-2.32.0.min.js"
      charset="utf-8"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Chosen Palette: Warm Neutrals with Slate Blue Accent -->
    <!-- Application Structure Plan: 本應用程式採用敘事性的單頁滾動結構，引導使用者完成一趟探索之旅。1. **開篇事實查核**：立即抓住使用者注意力，澄清社群媒體的錯誤資訊。2. **核心概念解析**：透過互動式對比，解釋「吸引力」與「黏著度」的關鍵差異。3. **互動數據排名**：使用可點擊的長條圖呈現前十名城市，鼓勵使用者主動探索。4. **城市深度剖析與地圖**：將圖表與地圖、文字內容連動，提供深入的背景資訊。5. **宏觀洞見總結**：以資訊卡片形式提煉報告的關鍵啟示。這個結構將複雜的報告內容分解為易於消化且具互動性的模組，比線性閱讀原始報告更能提升使用者的參與感和理解度。 -->
    <!-- Visualization & Content Choices: 1. **事實查核** (目標: 比較/告知) -> 使用HTML/Tailwind網格並列呈現，視覺化數據差異。2. **吸引力vs.黏著度** (目標: 比較/組織) -> 使用HTML/CSS與JS互動高亮效果，讓使用者主動探索兩者區別。3. **全球排名** (目標: 比較/告知) -> 使用Chart.js水平長條圖(Canvas)，清晰展示排名，並使其可點擊以觸發互動。4. **城市地理分佈與細節** (目標: 關聯/探索) -> 使用Plotly.js散點地圖(WebGL)，與長條圖連動，動態更新文字說明區塊，建立數據、地理和質化內容的關聯。5. **關鍵啟示** (目標: 總結/告知) -> 使用HTML/CSS資訊卡片，將抽象概念具象化。所有選擇均旨在將靜態報告轉化為動態的、以使用者為中心的探索體驗。 -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
      body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: #fdfbf8;
        color: #383838;
      }
      .text-balance {
        text-wrap: balance;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        height: 500px;
        max-height: 70vh;
      }
      .map-container {
        position: relative;
        width: 100%;
        height: 450px;
        max-height: 60vh;
      }
      .factor-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .factor-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .nav-button {
        transition: color 0.3s ease, border-color 0.3s ease;
      }
      .nav-button.active {
        color: #4a6c8b;
        border-color: #4a6c8b;
      }
      .nav-button:not(.active):hover {
        color: #6b8baa;
      }
    </style>
  </head>
  <body class="antialiased">
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
      <nav
        class="container mx-auto px-6 py-3 flex justify-between items-center"
      >
        <h1 class="text-xl md:text-2xl font-bold text-[#3E5C76]">
          城市磁吸力報告
        </h1>
        <div class="hidden md:flex space-x-6 text-gray-600">
          <a
            href="#fact-check"
            class="nav-button pb-1 border-b-2 border-transparent"
            >事實查核</a
          >
          <a
            href="#concept"
            class="nav-button pb-1 border-b-2 border-transparent"
            >核心概念</a
          >
          <a
            href="#ranking"
            class="nav-button pb-1 border-b-2 border-transparent"
            >數據排名</a
          >
          <a
            href="#insights"
            class="nav-button pb-1 border-b-2 border-transparent"
            >未來啟示</a
          >
        </div>
      </nav>
    </header>

    <!-- Audio Section -->
    <section class="bg-white/60 backdrop-blur-sm border-b border-gray-100 py-6">
      <div class="container mx-auto px-6">
        <div class="flex justify-start mb-4">
          <a
            href="../../index.html"
            class="bg-[#F0F4F8]/90 text-[#3E5C76] px-4 py-2 rounded-full shadow-lg border border-[#C5D4E2] backdrop-blur-sm flex items-center hover:bg-[#E5EDF5] hover:text-[#2D4A63] transition-all duration-200"
            style="font-size: 0.95rem; font-weight: 500"
          >
            <span class="mr-2">←</span> 返回首頁
          </a>
        </div>
        <div class="max-w-2xl mx-auto">
          <div
            class="bg-white p-6 rounded-xl shadow-md border border-[#C5D4E2]"
          >
            <label
              class="block text-[#3E5C76] font-semibold mb-3 text-center text-lg flex items-center justify-center"
            >
              <span class="text-2xl mr-2">🎧</span>
              中文導覽
            </label>
            <audio
              id="audioPlayerStickiness"
              controls
              class="w-full rounded shadow border border-[#C5D4E2] bg-white mb-3"
            >
              <source src="(CH) urban_stickiness.wav" type="audio/mpeg" />
              Your browser does not support the audio element.
            </audio>
            <div class="flex justify-center">
              <label for="speedStickiness" class="mr-2 text-sm text-gray-600"
                >播放速度：</label
              >
              <select
                id="speedStickiness"
                class="border border-[#C5D4E2] rounded px-2 py-1 text-sm"
              >
                <option value="0.75">0.75x</option>
                <option value="1" selected>1x</option>
                <option value="1.25">1.25x</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </section>

    <main class="container mx-auto px-6 py-12">
      <section id="fact-check" class="text-center mb-20 md:mb-24 scroll-mt-24">
        <h2
          class="text-3xl md:text-4xl font-bold text-[#3E5C76] mb-4 text-balance"
        >
          社群瘋傳的城市排名，是真的嗎？
        </h2>
        <p class="max-w-3xl mx-auto text-gray-600 mb-12 text-balance">
          近期一則關於「城市黏著度」的貼文在社群媒體上廣泛流傳，但其數據與
          Gensler 研究院的官方報告存在顯著差異。本部分將直接比對，釐清事實。
        </p>
        <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
          <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
            <h3 class="text-xl font-bold text-red-600 mb-4">❌ 網路流傳版本</h3>
            <div class="space-y-3 text-left">
              <p class="text-lg"><strong>1. 台北:</strong> 64%</p>
              <p class="text-lg"><strong>2. 胡志明市:</strong> 61%</p>
              <p class="text-lg"><strong>3. 新加坡:</strong> 59%</p>
            </div>
            <p class="mt-4 text-sm text-gray-500">
              結論：數據與排名均有誤，且胡志明市未進入全球前十。
            </p>
          </div>
          <div
            class="bg-white p-6 rounded-xl shadow-lg border-2 border-[#4A6C8B]"
          >
            <h3 class="text-xl font-bold text-green-700 mb-4">
              ✅ Gensler 官方報告
            </h3>
            <div class="space-y-3 text-left">
              <p class="text-lg"><strong>1. 台北:</strong> 85%</p>
              <p class="text-lg"><strong>2. 首爾:</strong> 82%</p>
              <p class="text-lg"><strong>3. 新加坡:</strong> 80%</p>
            </div>
            <p class="mt-4 text-sm text-gray-500">
              結論：真實數據遠高於傳聞，排名組合也不同。
            </p>
          </div>
        </div>
      </section>

      <hr class="my-20 md:my-24 border-gray-200" />

      <section id="concept" class="mb-20 md:mb-24 scroll-mt-24">
        <div class="text-center mb-12">
          <h2
            class="text-3xl md:text-4xl font-bold text-[#3E5C76] mb-4 text-balance"
          >
            吸引力 vs. 黏著度：城市留才的關鍵
          </h2>
          <p class="max-w-3xl mx-auto text-gray-600 text-balance">
            Gensler
            報告的核心洞見在於：吸引人們「遷入」的務實因素，與讓他們「留下」的情感因素截然不同。成功的城市必須同時兼顧兩者。
          </p>
        </div>
        <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
          <div class="bg-white p-8 rounded-xl shadow-md border border-gray-200">
            <h3 class="text-2xl font-bold mb-6 text-center text-gray-700">
              吸引力因素<span class="text-base font-normal block"
                >（讓人們遷入的務實考量）</span
              >
            </h3>
            <ul class="space-y-4">
              <li class="factor-card p-4 rounded-lg bg-gray-50 border">
                <h4 class="font-bold text-lg">💰 生活成本</h4>
                <p class="text-gray-600 text-sm">
                  城市的生活開銷是否在可負擔範圍內。
                </p>
              </li>
              <li class="factor-card p-4 rounded-lg bg-gray-50 border">
                <h4 class="font-bold text-lg">🛡️ 犯罪率水平</h4>
                <p class="text-gray-600 text-sm">
                  城市是否提供安全的居住環境。
                </p>
              </li>
              <li class="factor-card p-4 rounded-lg bg-gray-50 border">
                <h4 class="font-bold text-lg">🏥 高品質醫療</h4>
                <p class="text-gray-600 text-sm">
                  能否方便地獲得優質的醫療服務。
                </p>
              </li>
              <li class="factor-card p-4 rounded-lg bg-gray-50 border">
                <h4 class="font-bold text-lg">💼 就業機會</h4>
                <p class="text-gray-600 text-sm">
                  城市是否提供充足且優質的工作機會。
                </p>
              </li>
            </ul>
          </div>
          <div
            class="bg-[#F0F4F8] p-8 rounded-xl shadow-lg border-2 border-[#4A6C8B]"
          >
            <h3 class="text-2xl font-bold mb-6 text-center text-[#3E5C76]">
              黏著度因素<span class="text-base font-normal block"
                >（讓人們留下的情感連結）</span
              >
            </h3>
            <ul class="space-y-4">
              <li
                class="factor-card p-4 rounded-lg bg-white border border-blue-100"
              >
                <h4 class="font-bold text-lg text-[#4A6C8B]">
                  🎉 「我在我的城市不感到無聊。」
                </h4>
                <p class="text-gray-600 text-sm">
                  城市提供豐富多元的文化、娛樂與生活體驗。
                </p>
              </li>
              <li
                class="factor-card p-4 rounded-lg bg-white border border-blue-100"
              >
                <h4 class="font-bold text-lg text-[#4A6C8B]">
                  🏡 「我在我的城市有家的感覺。」
                </h4>
                <p class="text-gray-600 text-sm">
                  城市營造出安全、舒適且具歸屬感的氛圍。
                </p>
              </li>
              <li
                class="factor-card p-4 rounded-lg bg-white border border-blue-100"
              >
                <h4 class="font-bold text-lg text-[#4A6C8B]">
                  orgullo 「我為我的城市感到驕傲。」
                </h4>
                <p class="text-gray-600 text-sm">
                  居民對城市的獨特文化、歷史與成就感到認同。
                </p>
              </li>
              <li
                class="factor-card p-4 rounded-lg bg-white border border-blue-100"
              >
                <h4 class="font-bold text-lg text-[#4A6C8B]">
                  🌱 「我的城市適合變老。」
                </h4>
                <p class="text-gray-600 text-sm">
                  城市展現出對居民全生命週期的關懷與規劃。
                </p>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <hr class="my-20 md:my-24 border-gray-200" />

      <section id="ranking" class="mb-20 md:mb-24 scroll-mt-24">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-[#3E5C76] mb-4">
            全球十大「最黏」城市互動排名
          </h2>
          <p class="max-w-3xl mx-auto text-gray-600 text-balance">
            以下是官方報告中，居民留存意願最高的十大城市。點擊圖表中的城市，即可在地圖和下方的分析區塊查看更多詳細資訊。
          </p>
        </div>
        <div
          class="bg-white p-4 sm:p-6 md:p-8 rounded-xl shadow-lg border border-gray-200"
        >
          <div class="chart-container">
            <canvas id="stickyCitiesChart"></canvas>
          </div>
        </div>
      </section>

      <section id="deep-dive" class="scroll-mt-24">
        <div class="grid lg:grid-cols-5 gap-8">
          <div
            class="lg:col-span-2 bg-white p-8 rounded-xl shadow-lg border border-gray-200 h-full"
          >
            <h3 class="text-2xl font-bold text-[#3E5C76] mb-1">
              深度剖析：<span id="cityName"></span>
            </h3>
            <p class="text-gray-500 mb-4">
              排名 <span id="cityRank"></span> |
              <span id="cityPercentage"></span> 的居民表示不太可能搬離
            </p>
            <div
              id="cityDescription"
              class="text-gray-700 space-y-4 text-balance"
            ></div>
          </div>
          <div
            class="lg:col-span-3 bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-gray-200"
          >
            <div class="map-container">
              <div id="map"></div>
            </div>
          </div>
        </div>
      </section>

      <hr class="my-20 md:my-24 border-gray-200" />

      <section id="insights" class="scroll-mt-24">
        <div class="text-center mb-12">
          <h2
            class="text-3xl md:text-4xl font-bold text-[#3E5C76] mb-4 text-balance"
          >
            給未來城市的啟示
          </h2>
          <p class="max-w-3xl mx-auto text-gray-600 text-balance">
            Gensler
            的報告為城市治理者提供了三大戰略方向，強調從硬體建設轉向「情感基礎設施」的培養。
          </p>
        </div>
        <div class="grid md:grid-cols-3 gap-8">
          <div
            class="bg-white p-8 rounded-xl shadow-md border border-gray-200 text-center"
          >
            <div class="text-5xl mb-4">🏛️</div>
            <h3 class="text-xl font-bold mb-2 text-[#3E5C76]">情感基礎設施</h3>
            <p class="text-gray-600">
              投資於能培養社群感、激發自豪感的公共空間與文化體驗，其重要性不亞於道路和橋樑。
            </p>
          </div>
          <div
            class="bg-white p-8 rounded-xl shadow-md border border-gray-200 text-center"
          >
            <div class="text-5xl mb-4">🧩</div>
            <h3 class="text-xl font-bold mb-2 text-[#3E5C76]">新移民的挑戰</h3>
            <p class="text-gray-600">
              城市需制定策略幫助新居民融入社群，將他們從過客轉變為公民，以降低人才流失。
            </p>
          </div>
          <div
            class="bg-white p-8 rounded-xl shadow-md border border-gray-200 text-center"
          >
            <div class="text-5xl mb-4">⚖️</div>
            <h3 class="text-xl font-bold mb-2 text-[#3E5C76]">
              可負擔性的悖論
            </h3>
            <p class="text-gray-600">
              低生活成本能吸引人，但無法留住人。城市不能單靠「便宜」來購買忠誠度，情感連結才是關鍵。
            </p>
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-gray-800 text-white mt-24">
      <div class="container mx-auto px-6 py-8 text-center">
        <p>
          本頁面內容根據
          <a
            href="https://www.gensler.com/gri/city-pulse-2025"
            target="_blank"
            rel="noopener noreferrer"
            class="underline hover:text-gray-300"
            >Gensler Research Institute《City Pulse 2025: The Magnetic City》</a
          >報告製作。
        </p>
        <p class="text-sm text-gray-400 mt-2">
          該研究調查了全球65個主要城市的超過33,000名居民。
        </p>
      </div>
    </footer>

    <script>
      // Audio speed control
      document.addEventListener("DOMContentLoaded", function () {
        const audioStickiness = document.getElementById(
          "audioPlayerStickiness"
        );
        const speedStickiness = document.getElementById("speedStickiness");
        speedStickiness.addEventListener("change", function () {
          audioStickiness.playbackRate = parseFloat(this.value);
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const citiesData = [
          {
            rank: 1,
            name: "台北",
            country: "台灣",
            percentage: 85,
            coords: [25.033, 121.5654],
            description:
              "台北以驚人的85%比例高居榜首。其卓越表現歸功於世界級的便利公共交通、極高的治安水平和充滿活力的街頭巷尾，完美詮釋了「不感到無聊」和「有家的感覺」。豐富的飲食文化、多元的文創活動和強烈的在地認同感，極大地增強了居民的城市自豪感。",
          },
          {
            rank: 2,
            name: "首爾",
            country: "韓國",
            percentage: 82,
            coords: [37.5665, 126.978],
            description:
              "作為韓國的經濟與文化心臟，首爾將超現代科技與深厚歷史底蘊無縫融合。從繁華的購物區到靜謐的古宮，從世界頂尖的流行文化到精緻的傳統藝術，首爾的多元體驗使其居民「不感到無聊」，強烈的國家認同感與城市自豪感也是凝聚人心的重要力量。",
          },
          {
            rank: 3,
            name: "新加坡",
            country: "新加坡",
            percentage: 80,
            coords: [1.3521, 103.8198],
            description:
              "作為一個高度組織化、以安全和綠化聞名的花園城市國家，新加坡為居民提供了極高的生活品質和「家的感覺」。報告特別指出，作為一個城邦國家，新加坡是其國民在國內的「唯一城市選擇」，這本身就是一個強大的留存因素。",
          },
          {
            rank: 4,
            name: "慕尼黑",
            country: "德國",
            percentage: 79,
            coords: [48.1351, 11.582],
            description:
              "慕尼黑是榜單上排名最高的歐洲城市。它不僅是德國的經濟重鎮，更以高品質的生活環境、豐富的文化活動和親近自然的地理位置著稱。經濟活力與休閒生活的完美平衡，讓居民產生強烈的歸屬感和自豪感。",
          },
          {
            rank: 5,
            name: "蒙特雷",
            country: "墨西哥",
            percentage: 78,
            coords: [25.6866, -100.3161],
            description:
              "蒙特雷的入選是「全球南方崛起」的有力證明。作為墨西哥的工業中心，它被形容為一個既能提供豐富機會，又「高度宜居」的城市。強烈的地域文化、緊密的社群聯繫和充滿活力的公共生活，在建立居民歸屬感方面發揮了關鍵作用。",
          },
          {
            rank: 6,
            name: "墨西哥城",
            country: "墨西哥",
            percentage: 77,
            coords: [19.4326, -99.1332],
            description:
              "這座拉丁美洲大都會擁有世界級的博物館、豐富的歷史遺產和無與倫比的美食景觀，為居民提供了源源不斷的文化滋養，讓他們「不感到無聊」。深厚的文化底蘊和強烈的民族自豪感，是其居民選擇長久留下的重要情感基石。",
          },
          {
            rank: 7,
            name: "倫敦",
            country: "英國",
            percentage: 75,
            coords: [51.5072, -0.1276],
            description:
              "作為全球金融與文化中心，倫敦的黏著度源於無可比擬的多元性與活力。世界頂級的劇院、博物館和多元化的社區，使其成為一個永遠充滿新鮮感的城市。其提供的獨特體驗，讓居民產生了強烈的歸屬感和身為「倫敦人」的自豪感。",
          },
          {
            rank: 8,
            name: "波哥大",
            country: "哥倫比亞",
            percentage: 74,
            coords: [4.711, -74.0721],
            description:
              "波哥大近年來在城市更新、公共空間營造和文化發展方面取得了顯著進步。其創新的公共交通系統、遍布城市的自行車道網絡和蓬勃發展的藝術場景，提升了居民的生活品質和城市自豪感。",
          },
          {
            rank: 9,
            name: "雪梨",
            country: "澳洲",
            percentage: 73,
            coords: [-33.8688, 151.2093],
            description:
              "雪梨以其標誌性的海港景觀、宜人的氣候和輕鬆戶外的生活方式而聞名。居民能夠在繁華的都市生活與美麗的自然風光之間輕鬆切換，這種平衡極大地提升了幸福感和「家的感覺」。",
          },
          {
            rank: 10,
            name: "上海",
            country: "中國",
            percentage: 72,
            coords: [31.2304, 121.4737],
            description:
              "作為中國的經濟中心，上海以其快速的發展、高效的管理和不斷變化的天際線而令居民自豪。這座城市融合了傳統與現代魅力，提供了豐富多元的生活體驗，其活力與機遇使其居民「不感到無聊」，並對未來充滿信心。",
          },
        ];

        let chart;
        let currentCityIndex = 0;

        const chartCanvas = document.getElementById("stickyCitiesChart");
        const cityNameEl = document.getElementById("cityName");
        const cityRankEl = document.getElementById("cityRank");
        const cityPercentageEl = document.getElementById("cityPercentage");
        const cityDescriptionEl = document.getElementById("cityDescription");
        const mapDiv = document.getElementById("map");

        function createChart() {
          const ctx = chartCanvas.getContext("2d");
          chart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: citiesData.map((c) => `${c.rank}. ${c.name}`),
              datasets: [
                {
                  label: "「不太可能搬離」居民比例 (%)",
                  data: citiesData.map((c) => c.percentage),
                  backgroundColor: citiesData.map((_, i) =>
                    i === currentCityIndex ? "#4A6C8B" : "#C5D4E2"
                  ),
                  borderColor: citiesData.map((_, i) =>
                    i === currentCityIndex ? "#3E5C76" : "#A9B9C9"
                  ),
                  borderWidth: 2,
                  borderRadius: 4,
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return ` ${context.raw}% 的居民不太可能搬離`;
                    },
                  },
                },
              },
              scales: {
                x: {
                  beginAtZero: true,
                  max: 100,
                  grid: {
                    color: "#E5E7EB",
                  },
                },
                y: {
                  grid: {
                    display: false,
                  },
                },
              },
              onClick: (event, elements) => {
                if (elements.length > 0) {
                  const index = elements[0].index;
                  updateContent(index);
                }
              },
            },
          });
        }

        function createMap() {
          const mapData = [
            {
              type: "scattergeo",
              lon: citiesData.map((c) => c.coords[1]),
              lat: citiesData.map((c) => c.coords[0]),
              text: citiesData.map(
                (c) => `${c.rank}. ${c.name}: ${c.percentage}%`
              ),
              mode: "markers",
              marker: {
                size: citiesData.map((_, i) =>
                  i === currentCityIndex ? 20 : 10
                ),
                color: citiesData.map((_, i) =>
                  i === currentCityIndex ? "#D64933" : "#4A6C8B"
                ),
                opacity: 0.8,
                line: {
                  color: "white",
                  width: 1,
                },
              },
            },
          ];

          const layout = {
            geo: {
              projection: {
                type: "natural earth",
              },
              showland: true,
              landcolor: "#F0F4F8",
              showocean: true,
              oceancolor: "#FFFFFF",
              bgcolor: "#FDFBF8",
              countrycolor: "#BCCCDC",
              showcountries: true,
              showsubunits: true,
              subunitcolor: "#BCCCDC",
            },
            margin: { l: 0, r: 0, t: 0, b: 0 },
            paper_bgcolor: "#FDFBF8",
          };

          Plotly.newPlot(mapDiv, mapData, layout, {
            responsive: true,
            displayModeBar: false,
          });
        }

        function updateContent(index) {
          currentCityIndex = index;
          const city = citiesData[index];

          cityNameEl.textContent = city.name;
          cityRankEl.textContent = city.rank;
          cityPercentageEl.textContent = `${city.percentage}%`;
          cityDescriptionEl.innerHTML = `<p>${city.description}</p>`;

          chart.data.datasets[0].backgroundColor = citiesData.map((_, i) =>
            i === index ? "#4A6C8B" : "#C5D4E2"
          );
          chart.data.datasets[0].borderColor = citiesData.map((_, i) =>
            i === index ? "#3E5C76" : "#A9B9C9"
          );
          chart.update();

          Plotly.update(
            mapDiv,
            {
              "marker.size": [
                citiesData.map((_, i) => (i === index ? 20 : 10)),
              ],
              "marker.color": [
                citiesData.map((_, i) => (i === index ? "#D64933" : "#4A6C8B")),
              ],
            },
            {},
            [0]
          );
        }

        function setupNavObserver() {
          const sections = document.querySelectorAll("section[id]");
          const navLinks = document.querySelectorAll(".nav-button");

          const observer = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  navLinks.forEach((link) => {
                    link.classList.remove("active");
                    if (
                      link.getAttribute("href").substring(1) === entry.target.id
                    ) {
                      link.classList.add("active");
                    }
                  });
                }
              });
            },
            { rootMargin: "-50% 0px -50% 0px" }
          );

          sections.forEach((section) => observer.observe(section));

          navLinks.forEach((link) => {
            link.addEventListener("click", (e) => {
              e.preventDefault();
              document.querySelector(link.getAttribute("href")).scrollIntoView({
                behavior: "smooth",
              });
            });
          });
        }

        createChart();
        createMap();
        updateContent(0);
        setupNavObserver();
      });
    </script>
  </body>
</html>
